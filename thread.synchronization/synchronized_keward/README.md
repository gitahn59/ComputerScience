# synchronized를 이용한 동기화

> 공유 데이터를 사용하는 코드 영역을 임계 영역으로 지정   
> 공유 데이터(객체)가 가지고 있는 lock을 보유한 하나의 쓰레드만 영역 내의 코드를 수행   
> 임계 영역을 벗어나면 lock을 반납해 다른 쓰레드가 반납된 lock을 획득하여 코드 수행

## 1. 메서드 임계 영역

> 메서드 자체에 임계영역을 설정하여 메서드 전체가 임계 영역으로 설정   
> 메서드가 호출되는 시점에 인스턴스에 락을 걸게 되므로 다른 쓰레드는   
> lock을 얻기 위해 대기함

```java
synchronized void mymethod(){
}
```

## 2. synchronized 블럭

> 락을 걸고자 하는 객체를 참조하여 락을 거는 방법

```java
synchronized(object){  
}
```

## 3. synchronized를 이용한 동기화의 특징
* synchronized로 동기화를 통해 공유 데이터를 보호할 수 있음
* 하지만 특정 쓰레드가 락을 가진 상태로 오랜 시간을 보낼 수도 있으며 이를 방지할 수 없음.
* 따라서 이를 방지하기 위해 wait와 notify를 활용함   

## 4. 공장 예제
> Factory는 아이템을 보유 하고 있음.   
> Customer는 공장이 보유한 아이템이 1개 이상이면 아이템을 구매함.

### 동기화를 수행하지 않는 경우
> item의 개수가 0개 보다 작아지기 전에 다른 쓰레드에서 item의 개수를 참조하면
음수개의 item이 남게됨

### sell()에 동기화
> sell 메서드를 임계구역으로 설정하여 item 확인과 소비가 1개의 쓰레드에서만   
> 이루어지도록 동기화하여 오류를 방지